<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>STUDIO ADMIN</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
</head>
<body class="bg-gray-50 flex">

    <aside class="w-64 bg-black h-screen sticky top-0 p-8 text-white">
        <div class="text-2xl font-black mb-20 italic">ADMIN.</div>
        <nav class="space-y-6">
            <button onclick="showTab('prod-tab')" class="block font-bold uppercase text-[10px] tracking-widest opacity-50 hover:opacity-100">Products</button>
            <button onclick="showTab('cat-tab')" class="block font-bold uppercase text-[10px] tracking-widest opacity-50 hover:opacity-100">Categories</button>
            <button onclick="showTab('settings-tab')" class="block font-bold uppercase text-[10px] tracking-widest opacity-50 hover:opacity-100">Footer & Settings</button>
        </nav>
    </aside>

    <main class="flex-1 p-16">
        
        <section id="prod-tab" class="tab-content">
            <div class="flex justify-between items-end mb-12">
                <h2 class="text-4xl font-black italic uppercase">Inventory</h2>
                <button onclick="resetProdForm()" class="bg-black text-white px-8 py-3 rounded-full font-bold text-xs">Add New Product</button>
            </div>

            <div class="grid lg:grid-cols-2 gap-12">
                <div class="bg-white p-10 rounded-[2rem] shadow-sm">
                    <input type="hidden" id="p-id">
                    <input type="text" id="p-title" placeholder="Product Title" class="w-full mb-4 p-4 bg-gray-50 rounded-xl border-none">
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <input type="number" id="p-price" placeholder="Price" class="p-4 bg-gray-50 rounded-xl border-none">
                        <select id="p-cat-select" class="p-4 bg-gray-50 rounded-xl border-none"></select>
                    </div>
                    <textarea id="p-description" placeholder="Description (HTML Allowed)" rows="5" class="w-full mb-4 p-4 bg-gray-50 rounded-xl border-none"></textarea>
                    <input type="text" id="p-gumroad" placeholder="Gumroad Product URL" class="w-full mb-4 p-4 bg-gray-50 rounded-xl border-none">
                    <div id="image-inputs" class="space-y-2 mb-6">
                        <p class="text-[10px] font-black uppercase text-gray-400">Image URLs (Max 10)</p>
                        <input type="text" class="p-img-url w-full p-3 bg-gray-50 rounded-lg text-xs" placeholder="Image URL 1">
                    </div>
                    <button onclick="addImageInput()" class="text-[10px] font-black uppercase mb-6">+ Add Image Slot</button>
                    <button onclick="saveProduct()" class="w-full bg-black text-white py-5 rounded-2xl font-black uppercase tracking-widest">Save Product</button>
                </div>
                
                <div id="admin-prod-list" class="space-y-4"></div>
            </div>
        </section>

        <section id="cat-tab" class="tab-content hidden">
            <h2 class="text-4xl font-black italic uppercase mb-12">Categories</h2>
            <div class="bg-white p-10 rounded-[2rem] max-w-2xl">
                <div class="flex gap-4 mb-10">
                    <input type="text" id="cat-name" placeholder="Category Name" class="flex-1 p-4 bg-gray-50 rounded-xl border-none">
                    <button onclick="addCategory()" class="bg-black text-white px-10 rounded-xl font-black uppercase text-xs">Add</button>
                </div>
                <div id="admin-cat-list" class="space-y-3"></div>
            </div>
        </section>

    </main>

    <script src="../firebase-config.js"></script>
    <script>
        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        // --- KATEGORİ LOGIC ---
        function addCategory() {
            const name = document.getElementById('cat-name').value;
            if(!name) return;
            db.ref('categories').push({
                name,
                inHeader: true,
                inFooter: true
            });
            document.getElementById('cat-name').value = "";
        }

        db.ref('categories').on('value', snap => {
            const cats = snap.val() ? Object.entries(snap.val()) : [];
            const list = document.getElementById('admin-cat-list');
            const select = document.getElementById('p-cat-select');
            
            list.innerHTML = cats.map(([id, c]) => `
                <div class="flex justify-between items-center p-4 bg-gray-50 rounded-xl">
                    <span class="font-bold uppercase text-xs">${c.name}</span>
                    <button onclick="db.ref('categories/${id}').remove()" class="text-red-500 font-black">X</button>
                </div>
            `).join('');

            select.innerHTML = cats.map(([id, c]) => `<option value="${c.name}">${c.name}</option>`).join('');
        });

        // --- ÜRÜN LOGIC ---
        function addImageInput() {
            const container = document.getElementById('image-inputs');
            if(container.querySelectorAll('input').length < 10) {
                const input = document.createElement('input');
                input.className = "p-img-url w-full p-3 bg-gray-50 rounded-lg text-xs mt-2";
                input.placeholder = "Next Image URL";
                container.appendChild(input);
            }
        }

        function saveProduct() {
            const id = document.getElementById('p-id').value || db.ref('products').push().key;
            const images = Array.from(document.querySelectorAll('.p-img-url')).map(i => i.value).filter(v => v !== "");
            
            const data = {
                id,
                title: document.getElementById('p-title').value,
                price: document.getElementById('p-price').value,
                category: document.getElementById('p-cat-select').value,
                description: document.getElementById('p-description').value,
                gumroadUrl: document.getElementById('p-gumroad').value,
                images: images,
                createdAt: Date.now()
            };

            db.ref('products/' + id).set(data, () => {
                alert("Product Saved!");
                location.reload();
            });
        }

        db.ref('products').on('value', snap => {
            const prods = snap.val() ? Object.values(snap.val()) : [];
            document.getElementById('admin-prod-list').innerHTML = prods.reverse().map(p => `
                <div class="bg-white p-6 rounded-2xl shadow-sm flex justify-between items-center">
                    <div class="flex items-center gap-4">
                        <img src="${p.images[0]}" class="w-12 h-12 object-cover rounded-lg">
                        <div>
                            <h4 class="font-black text-xs uppercase">${p.title}</h4>
                            <p class="text-[10px] text-gray-400 font-bold uppercase">${p.category}</p>
                        </div>
                    </div>
                    <div class="flex gap-4">
                        <button onclick="editProd('${p.id}')" class="text-xs font-black uppercase text-blue-500">Edit</button>
                        <button onclick="db.ref('products/${p.id}').remove()" class="text-xs font-black uppercase text-red-500">Delete</button>
                    </div>
                </div>
            `).join('');
        });

        function editProd(id) {
            db.ref('products/' + id).once('value', snap => {
                const p = snap.val();
                document.getElementById('p-id').value = p.id;
                document.getElementById('p-title').value = p.title;
                document.getElementById('p-price').value = p.price;
                document.getElementById('p-cat-select').value = p.category;
                document.getElementById('p-description').value = p.description;
                document.getElementById('p-gumroad').value = p.gumroadUrl;
                // Resimleri doldurma logic'i eklenebilir
                showTab('prod-tab');
            });
        }
    </script>
</body>
</html>
