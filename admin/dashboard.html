<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Fourthwall Clone Admin</title>
    <link rel="stylesheet" href="../css/admin.css">
    <style>
        .recent-activity {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            margin-top: 30px;
        }
        
        .activity-list {
            list-style: none;
        }
        
        .activity-item {
            padding: 15px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-time {
            color: #666;
            font-size: 12px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="logo">
                <h2>Admin Panel</h2>
            </div>
            <nav>
                <ul>
                    <li><a href="dashboard.html" class="active">Dashboard</a></li>
                    <li><a href="products.html">Products</a></li>
                    <li><a href="categories.html">Categories</a></li>
                    <li><a href="footer.html">Footer Settings</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <header class="admin-header">
                <h1>Dashboard</h1>
                <button class="btn-logout" id="logoutBtn">Logout</button>
            </header>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Products</h3>
                    <div class="number" id="totalProducts">0</div>
                </div>
                <div class="stat-card">
                    <h3>Active Products</h3>
                    <div class="number" id="activeProducts">0</div>
                </div>
                <div class="stat-card">
                    <h3>Categories</h3>
                    <div class="number" id="totalCategories">0</div>
                </div>
                <div class="stat-card">
                    <h3>Today's Views</h3>
                    <div class="number" id="todayViews">0</div>
                </div>
            </div>

            <!-- Recent Products -->
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Recent Products</th>
                            <th>Category</th>
                            <th>Price</th>
                            <th>Status</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody id="recentProductsTable">
                        <!-- Recent products will be loaded here -->
                    </tbody>
                </table>
            </div>

            <!-- Recent Activity -->
            <div class="recent-activity">
                <h3 style="margin-bottom: 20px;">Recent Activity</h3>
                <ul class="activity-list" id="recentActivity">
                    <li class="activity-item">
                        <div>Admin panel initialized</div>
                        <div class="activity-time">Just now</div>
                    </li>
                </ul>
            </div>
        </main>
    </div>

    <script type="module">
        import { auth, db, signOut } from '../js/firebase-config.js';
        import { collection, getDocs, query, where, orderBy, limit } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
        
        // Check authentication
        onAuthStateChanged(auth, (user) => {
            if (!user) {
                window.location.href = 'login.html';
            } else {
                loadDashboardData();
            }
        });
        
        // Logout
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            try {
                await signOut(auth);
                window.location.href = 'login.html';
            } catch (error) {
                console.error('Logout error:', error);
            }
        });
        
        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Load total products
                const productsSnapshot = await getDocs(collection(db, 'products'));
                document.getElementById('totalProducts').textContent = productsSnapshot.size;
                
                // Load active products
                const activeQuery = query(collection(db, 'products'), where('status', '==', 'active'));
                const activeSnapshot = await getDocs(activeQuery);
                document.getElementById('activeProducts').textContent = activeSnapshot.size;
                
                // Load categories
                const categoriesSnapshot = await getDocs(collection(db, 'categories'));
                document.getElementById('totalCategories').textContent = categoriesSnapshot.size;
                
                // Load recent products
                const recentQuery = query(
                    collection(db, 'products'),
                    orderBy('createdAt', 'desc'),
                    limit(5)
                );
                const recentSnapshot = await getDocs(recentQuery);
                const recentTable = document.getElementById('recentProductsTable');
                recentTable.innerHTML = '';
                
                recentSnapshot.forEach((doc) => {
                    const product = doc.data();
                    const row = document.createElement('tr');
                    
                    // Format date
                    const date = product.createdAt ? product.createdAt.toDate() : new Date();
                    const formattedDate = date.toLocaleDateString('en-US', {
                        month: 'short',
                        day: 'numeric'
                    });
                    
                    row.innerHTML = `
                        <td>${product.title}</td>
                        <td>${product.category || 'Uncategorized'}</td>
                        <td>$${product.price?.toFixed(2) || '0.00'}</td>
                        <td><span class="status-badge ${product.status === 'active' ? 'status-active' : 'status-draft'}">${product.status}</span></td>
                        <td>${formattedDate}</td>
                    `;
                    recentTable.appendChild(row);
                });
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }
    </script>
</body>
</html>
